---
title: "Importing Data"
---

```{r setup, echo=FALSE, warning=FALSE, purl=FALSE, message=FALSE}
options(repos = "http://cran.rstudio.com/")
pkgs <- c("dplyr", "knitr")
x<-lapply(pkgs, library, character.only = TRUE)
opts_chunk$set(tidy = FALSE, message = F, warning = F)
```

## Lesson Outline

- [Goals and Motivation]
- [Getting organized]
- [Getting your data into R]

## Goals and Motivation

Today, as you learn new concepts and utilities in R, we will also be teaching you how to set up your workflow so that you and your collaborators can use R more efficiently. By taking the time at the very beginning of a project to maintain code that is well organized and clear, you will create analyses that are more reproducible and shareable. And, when you come back to your files years later, you can pick back up right where you left off.

After this session you should be able answer the following:

* How do I create and organize my files in R?
* How do I import a dataset as a `.csv`?

## Getting organized

Before you start working on a new dataset in RStudio, it is very important that you create a place to store your files. Starting off organized and staying organized in R will make *future you* so much happier. So, we're going to encourage that you take a moment now to organize your files and keep things tidy.

### RStudio projects

I strongly encourage you to use RStudio projects when you are working with R.  The RStudio project provides a central location for working on a particular task.  It helps with file management and is portable because all the files live in the same project.  RStudio projects also remember history - what commands you used and what data objects are in your *Environment*.  

To create a new project, click on the File menu at the top of the RStudio window and select 'New project...'

![](figure/rstudio_proj.jpg)

Select "New Directory" > "New Project". Title this project "cabw_r_workshop" (we will use this directory for the rest of today's workshop), and save it to a filepath that is logical and easy for you to find in the future. Then, click "Create Project." In the RStudio window that just opened, you should now see your working directory printed along the top of the screen (e.g., ~/Desktop/cabw_r_workshop - RStudio).

Now, we can use this project for our data and any scripts we create.  

### Scripting

Up until this point, we have been working in the *Console*. In most cases, you will not enter and execute code directly in the *Console* but rather type and edit code in a script and then send it to the *Console* when you're ready to run it.  The key difference here is that a script can be saved and shared.

To open a new script, navigate to the File menu, and select "New File" > "R Script":

![](figure/rstudio_script.jpg)

Save that file into your newly created project and name it "cabw_script_day1.R". It'll just be a blank text file at this point.

A script works similarly to the *Console*, but it does have a few key differences. The first, is that you can add text that is not able to be run. This text is referred to as annotations or comments, and it is denoted by using a pound symbol or hashtag (`#`) prior to the text. Let's use this to add a title, name, and date to our new script.

```{r heading, echo = TRUE}

# CABW 2020 Bioassessment R Tutorial
# Firstname Lastname
# October 13, 2020

```


Let's practice making variables once more, but this time in our script file. Type the following into your script:

```{r variable, echo = TRUE}

#### Variables ####

# Create a new variable.
fish <- 10 + 45

```


After you write your script it can be sent to the Console to run the code in R. Any variables you create in your script will not be available in your working environment until this is done. There are two ways to send code to the console. First, you can hit the `Run` button at the top right of the scripting window. Second, and preferred, you can use `ctrl+enter` (`cmd+enter` on a Mac). Both approaches will send the selected line to the console, then move to the next line in your script. You can also highlight and send an entire block of code. If you'd like to run all the code in your script at once, you can use `ctrl+shift+enter` (`cmd+shift+enter` on a Mac).

![](figure/rstudio_run.jpg)

Place your cursor on the line where you've created the `fish` variable, and run the line of code. Check to be certain that this variable has now appeared in your *Environment*.

Add the following lines of code to your script, and then run each one:

```{r variables, echo = TRUE}

# Create additional variables.
nitrogen <- 79 - 15
algae <- fish * nitrogen

```


For the remainder of the workshop, we'll use this script instead of the *Console*. For comparison, working in the *Console* is like sending a lot of text messages, but working in this new script file is more like working in Word - you can save, edit, and track your changes, not to mention more easily collaborate with others to write files.

### Practice Exercise

1. Before we move on, take a moment to create some additional variables named `riffle` and `pool` in your script. 

1. Annotate your variables with a comment using the `#` notation so *future you* knows what you've done.

1. Run each of your new variables to be sure they appear in your *Environment*.

1. Save your script.

If you have any difficulty completing the above 4 steps, please send a message to Ryan, Heili, or one of the workshop assistants in the chat.

We have demonstrated that scripts are just as powerful as the *Console*, and they are much more useful. So, let's continue working in the script by loading in today's necessary packages and datasets.

### Attaching packages

At the beginning of most of your scripts, you will need to tell R which packages it needs to use to run the code below. So, we're going to install and attach some additional packages for this week's workshop.

In the *Console*, type and run the following lines of code:

`install.packages("sf")`

`install.packages("mapview")`

`install.packages("viridis")`

`install.packages("USAboundaries")`

We run these installations in the *Console*, because they only need to happen once and then your R will recognize them in perpetuity. Now, let's add the following to our script file and run each line to attach them for use today:

```{r packages, echo = TRUE, message = FALSE}

#### Packages ####

# Attach necessary packages.
library("tidyverse")

```

## Getting your data into R

It is the rare case when you manually enter your data in R, not to mention impractical for most datasets. Most data analysis workflows typically begin with importing a dataset from an external source. This means committing a dataset to memory (i.e., storing it as a variable) as one of R's data structure formats.

You should have downloaded today's datasets already, but if not, the data are available [here](https://SCCWRP.github.io/CABW2018_R_training/data/datazip.zip).  The data are in a zipped folder.  Download the file to your computer (anywhere).  Create a new folder in your cabw_r_workshop project named `data` and move the files into this location. Now, you should see them appear in the *Files* tab in the lower right hand corner of your RStudio window - this means the files are now a part of the same working directory as your script.

Flat data files (text only, rectangular format) present the least complications on import because there is very little to assume about the structure of the data. On import, R tries to guess the data type for each column, and this is fairly unambiguous with flat files.The base installation of R comes with some easy to use functions for importing flat files, but we're going to use the `read_csv()` function from the `readr` package, which you've already loaded in through the `tidyverse`. R comes with a built in function `read.csv()`, but we're going to use `read_csv()` because it does a slightly faster job of reading in data.

Now that we have the data downloaded and extracted to our data folder, we'll use `read_csv()` to import two files.

1. Type the following in your script.  Note the use of file paths within your project.

    ```{r data}
    
    # Load CSCI and ASCI datasets.
cscidat <- read_csv('data/cscidat.csv')
ascidat <- read_csv('data/ascidat.csv')

    ```

1. Send the commands to the console with `ctrl+enter`.

1. Verify that the data imported correctly by viewing the datasets in a spreadsheet style in a new window:

    ```{r view}
    
    # examine datasets in new windows
    View(cscidat)
    View(ascidat)

    ```

Let's explore the datasets a bit.  There are many useful functions for exploring the characteristics of a dataset.  This is always a good idea when you first import something.  

```{r explore}

# get the dimensions
dim(cscidat)
dim(ascidat)

# get the column names
names(cscidat)
names(ascidat)

# see the first six rows
head(cscidat)
head(ascidat)

# get the overall structure
str(cscidat)
str(ascidat)

```

### Data structures in R

There are many formats for storing data and R is no exception. We will introduce some of these types of data below.

### Vectors (one-dimensional data)

The basic data format in R is a vector - a one-dimensional grouping of elements that have the same type.  These are all vectors and they are created with the `c()` function:

```{r vectors}

# double vector
dbl_var <- c(1, 2.5, 4.5)

# integer vector
int_var <- c(1L, 6L, 10L)

# logical vector
log_var <- c(TRUE, FALSE, TRUE, FALSE)

# character vector
chr_var <- c("a", "b", "c")

```

The four types of vectors are `double` (or numeric), `integer`, `logical`, and `character`.  You can explore the type using the following functions:

```{r type}

# display vector type
class(dbl_var)

# display vector length
length(log_var)

```

These properties are useful for not only describing an object, but they define limits on which functions or types of operations that can be used.  For example, some functions require a character input while others require a numeric input. Similarly, vectors of different types or properties may not play well together. Let's look at some examples:

```{r vector error}

# take the mean of a character vector
mean(chr_var)

# adding two numeric vectors of different lengths
vec1 <- c(1, 2, 3, 4)
vec2 <- c(2, 3, 5)
vec1 + vec2

```

### 2-dimensional data

A collection of vectors represented as a single data object are often described as two-dimensional data.  A more common way of storing two-dimensional data is in a data frame (i.e., `data.frame`).  Think of them like your standard spreadsheet, where each column describes a variable and rows link observations between columns. An example would be our `ascidat` loaded above.

The only constraints required to make a data frame are:

1. Each column contains the same type of data

1. The number of observations in each column is equal.

You can call vectors within a data frame by using the `$` to refer to a certain column. Type the following into your script to see how this works:

```{r columns}

# calculate the mean CSCI value of the entire dataset
mean(cscidat$csci)

# assign the vector containing sampling site information to a new variable
Sites <- cscidat$site

```

This concludes the "importing data" section of our R tutorial today. If you are experiencing any issues, errors, or have a question, please take this moment to send Ryan, Heili, or one of the workshop assistants a message in the chat.
